CMAKE_MINIMUM_REQUIRED(VERSION 2.6)
PROJECT(snappy)

INCLUDE(CheckIncludeFiles)
INCLUDE(CMakePackageConfigHelpers)

CHECK_INCLUDE_FILES("stdint.h" HAVE_STDINT_H)
CHECK_INCLUDE_FILES("stddef.h" HAVE_STDDEF_H)
CHECK_INCLUDE_FILES("sys/uio.h" HAVE_SYS_UIO_H)

if (NOT HAVE_SYS_UIO_H)
  set(HAVE_SYS_UIO_H 0)
endif()

if (NOT HAVE_STDINT_H)
  set(HAVE_STDINT_H 0)
endif()

if (NOT HAVE_STDDEF_H)
  set(HAVE_STDDEF_H 0)
endif()

set(ac_cv_have_stdint_h ${HAVE_STDINT_H})
set(ac_cv_have_stddef_h ${HAVE_STDDEF_H})
set(ac_cv_have_sys_uio_h ${HAVE_SYS_UIO_H})
CONFIGURE_FILE(${snappy_SOURCE_DIR}/snappy-stubs-public.h.in
               snappy-stubs-public.h)

if (WIN32)
  ADD_DEFINITIONS(-D_CRT_SECURE_NO_WARNINGS)
endif()

set(SNAPPY_SRCS snappy.cc
  snappy-c.cc
  snappy-stubs-internal.cc
  snappy-sinksource.cc
  snappy.h
  snappy-c.h
  snappy-sinksource.h
  snappy-stubs-public.h)

add_library(snappy SHARED ${SNAPPY_SRCS})
add_library(snappystatic STATIC ${SNAPPY_SRCS})

TARGET_COMPILE_DEFINITIONS(snappy PRIVATE -DHAVE_CONFIG_H)
TARGET_COMPILE_DEFINITIONS(snappystatic PRIVATE -DHAVE_CONFIG_H)

install(FILES snappy.h
  snappy-c.h
  snappy-sinksource.h
  ${snappy_BINARY_DIR}/snappy-stubs-public.h
  DESTINATION include)

install(TARGETS snappy snappystatic
  RUNTIME DESTINATION bin
  LIBRARY DESTINATION lib
  ARCHIVE DESTINATION lib)